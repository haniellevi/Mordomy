{"version":3,"sources":["turbopack:///[project]/node_modules/openid-client/package.json","../../../../src/lib/prisma.ts","../../../../src/app/page.tsx"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst globalForPrisma = global as unknown as { prisma: PrismaClient };\r\n\r\nexport const prisma =\r\n    globalForPrisma.prisma ||\r\n    new PrismaClient({\r\n        log: [\"query\"],\r\n    });\r\n\r\nif (process.env.NODE_ENV !== \"production\") globalForPrisma.prisma = prisma;\r\n","import { redirect } from \"next/navigation\";\r\nimport { getCurrentUser } from \"@/lib/session\";\r\nimport { prisma } from \"@/lib/prisma\";\r\n\r\nexport default async function HomePage() {\r\n    const user = await getCurrentUser();\r\n\r\n    if (!user) {\r\n        redirect(\"/landing\");\r\n    }\r\n\r\n    // Tentar encontrar o último mês acessado ou o mais recente\r\n    const latestMonth = await prisma.month.findFirst({\r\n        where: { userId: user.id },\r\n        orderBy: [\r\n            { year: 'desc' },\r\n            { month: 'desc' }\r\n        ]\r\n    });\r\n\r\n    if (latestMonth) {\r\n        redirect(`/${latestMonth.year}/${latestMonth.month}`);\r\n    }\r\n\r\n    // Se não houver nenhum mês, criar o mês atual\r\n    const now = new Date();\r\n    const currentYear = now.getFullYear();\r\n    const currentMonth = now.getMonth() + 1;\r\n\r\n    try {\r\n        await prisma.month.create({\r\n            data: {\r\n                userId: user.id,\r\n                year: currentYear,\r\n                month: currentMonth,\r\n            }\r\n        });\r\n        redirect(`/${currentYear}/${currentMonth}`);\r\n    } catch (error) {\r\n        // Se der erro (ex: race condition), tentar redirecionar mesmo assim\r\n        // ou redirecionar para uma página de erro\r\n        console.error(\"Erro ao criar mês inicial:\", error);\r\n        // Fallback para landing se tudo falhar\r\n        redirect(\"/landing\");\r\n    }\r\n}\r\n"],"names":[],"mappings":"upBAAA,EAAA,CAAA,CAAA,CAAA,KAAA,gBAAA,QAAA,QAAA,YAAA,oGAAA,SAAA,CAAA,OAAA,iBAAA,QAAA,YAAA,SAAA,UAAA,UAAA,WAAA,SAAA,WAAA,WAAA,QAAA,SAAA,OAAA,SAAA,WAAA,gBAAA,WAAA,CAAA,SAAA,yCAAA,WAAA,sBAAA,QAAA,CAAA,IAAA,mCAAA,EAAA,QAAA,MAAA,OAAA,oCAAA,QAAA,CAAA,MAAA,qBAAA,OAAA,kBAAA,QAAA,gBAAA,EAAA,KAAA,iBAAA,MAAA,qBAAA,MAAA,CAAA,MAAA,mBAAA,CAAA,QAAA,CAAA,OAAA,8EAAA,KAAA,yBAAA,EAAA,aAAA,CAAA,KAAA,UAAA,YAAA,SAAA,cAAA,SAAA,kBAAA,QAAA,EAAA,gBAAA,CAAA,cAAA,aAAA,kBAAA,UAAA,UAAA,SAAA,KAAA,SAAA,MAAA,UAAA,KAAA,UAAA,SAAA,SAAA,oBAAA,SAAA,MAAA,SAAA,WAAA,QAAA,EAAA,mBAAA,CAAA,QAAA,CAAA,cAAA,8CAAA,EAAA,MAAA,CAAA,CAAA,KAAA,OAAA,QAAA,UAAA,EAAA,CAAA,KAAA,MAAA,QAAA,OAAA,EAAA,CAAA,KAAA,QAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,QAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,WAAA,QAAA,WAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,QAAA,cAAA,OAAA,CAAA,CAAA,EAAA,CAAA,KAAA,OAAA,OAAA,CAAA,CAAA,EAAA,CAAA,E,uTCAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAIO,IAAM,EAFP,AAGF,EAHE,CAAA,CAGc,MAAM,EACtB,IAAI,EAAA,YAAY,CAAC,CACb,IAAK,CAAC,QAAQ,AAClB,0ECRJ,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,eAAe,IAC1B,IAAM,EAAO,MAAM,CAAA,EAAA,EAAA,cAAA,AAAc,GAE7B,CAAC,GACD,CAAA,EADO,AACP,EAAA,QAAA,AAAQ,EAAC,YAIb,IAAM,EAAc,MAAM,EAAA,MAAM,CAAC,KAAK,CAAC,SAAS,CAAC,CAC7C,MAAO,CAAE,OAAQ,EAAK,EAAE,AAAC,EACzB,QAAS,CACL,CAAE,KAAM,MAAO,EACf,CAAE,MAAO,MAAO,EACnB,AACL,GAEI,GACA,CAAA,EAAA,EAAA,KADa,GACb,AAAQ,EAAC,CAAC,CAAC,EAAE,EAAY,IAAI,CAAC,CAAC,EAAE,EAAY,KAAK,CAAA,CAAE,EAIxD,IAAM,EAAM,IAAI,KACV,EAAc,EAAI,WAAW,GAC7B,EAAe,EAAI,QAAQ,GAAK,EAEtC,GAAI,CACA,MAAM,EAAA,MAAM,CAAC,KAAK,CAAC,MAAM,CAAC,CACtB,KAAM,CACF,OAAQ,EAAK,EAAE,CACf,KAAM,EACN,MAAO,CACX,CACJ,GACA,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,CAAC,CAAC,EAAE,EAAY,CAAC,EAAE,EAAA,CAAc,CAC9C,CAAE,MAAO,EAAO,CAGZ,QAAQ,KAAK,CAAC,6BAA8B,GAE5C,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,WACb,CACJ"}